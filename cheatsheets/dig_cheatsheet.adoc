:author-url: https://github.com/rridane
:source-highlighter: rouge
:hardbreaks:
:table-caption!:
:toc: left

= Cheatsheet dig

== ðŸ§  DIG â€” Domain Information Groper : Bases

=== ðŸ“Œ Syntaxe de base

----
dig [nom_de_domaine] [type_enregistrement] [@serveur_dns]
----

- `nom_de_domaine` : nom Ã  rÃ©soudre (ex: `example.com`)
- `type_enregistrement` : A, AAAA, MX, NS, TXT, etc. (par dÃ©faut : A)
- `@serveur_dns` : optionnel â€” DNS spÃ©cifique (ex: `@1.1.1.1`)

== ðŸ” Exemples simples

[source, bash]
----
# RÃ©solution enregistrement A (IPv4)
dig example.com

# RÃ©solution enregistrement AAAA (IPv6)
dig example.com AAAA

# RÃ©solution enregistrements MX
dig example.com MX

# PrÃ©ciser le serveur dns
dig example.com @8.8.8.8
----

== ðŸ”Ž Sections de la rÃ©ponse

1. *HEADER* : rÃ©sumÃ© de la requÃªte (code retour, ID, flags)
2. *QUESTION SECTION* : ce que `dig` a demandÃ©
3. *ANSWER SECTION* : rÃ©ponse(s) du serveur
4. *AUTHORITY SECTION* : serveurs faisant autoritÃ©
5. *ADDITIONAL SECTION* : infos supplÃ©mentaires (ex: IP des NS)
6. *OPT EDNS section*: voir ci-dessous

=== ðŸ”¹ OPT PSEUDOSECTION (EDNS)

Depuis l'extension EDNS(0), les rÃ©ponses DNS peuvent contenir une section supplÃ©mentaire appelÃ©e `OPT PSEUDOSECTION`.

----
;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
----

- `EDNS: version` : version d'EDNS utilisÃ©e (actuellement 0)
- `udp: 1232` : taille maximale des messages DNS en UDP
- `flags: do` : signifie que le client demande les donnÃ©es DNSSEC

Cette section nâ€™est pas un enregistrement DNS classique mais un *pseudo-record* pour transporter des options avancÃ©es comme DNSSEC, client subnet, etc.

Utiliser `+dnssec` ajoute automatiquement `do` dans cette section.

== ðŸ§° Options utiles

[source, bash]
----
# RÃ©sultat concis (sans fioriture)
dig +short example.com

# Ne pas utiliser le fichier /etc/resolv.conf
dig example.com +norecurse

# Voir tout (trÃ¨s verbeux, de la racine au domaine)
dig example.com +trace

# Afficher seulement lâ€™ANSWER
dig example.com +noall +answer

# Ajouter le TTL en unitÃ©s lisibles
dig example.com +ttlunits
----

== ðŸŒ RequÃªtes types frÃ©quentes

[source, bash]
----
# Liste des serveurs DNS faisant autoritÃ© pour example.com
dig example.com NS

# Voir les SPF, DKIM, etc.
dig example.com TXT

# Reverse DNS lookup
dig -x 8.8.8.8

# Infos sur le Start of Authority
dig example.com SOA

# Interroger les serveurs racine
dig @root-servers.net . NS
----

=== ðŸ“‹ DÃ©composition complÃ¨te du HEADER

Une ligne typique du `HEADER` ressemble Ã  ceci :

----
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 58279
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
----

Voici la signification de chaque champ :

==== ðŸ”¢ `id: 58279`
- Identifiant unique de la requÃªte DNS
- Permet au client de faire correspondre les rÃ©ponses avec ses requÃªtes

==== ðŸ” `opcode: QUERY`
- Type dâ€™opÃ©ration effectuÃ©e (souvent `QUERY`, mais pas toujours)

- Valeurs possibles :

|===
| Code | Nom | Description
| 0 | QUERY | RequÃªte DNS classique
| 1 | IQUERY | Inverse Query (dÃ©prÃ©ciÃ©)
| 2 | STATUS | Demande le statut du serveur
| 4 | NOTIFY | Notification de changement (DNS dynamique)
| 5 | UPDATE | Mise Ã  jour DNS dynamique
|===

==== ðŸŸ¢ `status: NOERROR`
- Code de retour DNS indiquant si la requÃªte a rÃ©ussi

- Valeurs possibles courantes :

|===
| Code | Signification | Description
| NOERROR | âœ… Pas dâ€™erreur | La rÃ©ponse est valide
| NXDOMAIN | âŒ Nom inexistant | Le domaine nâ€™existe pas
| SERVFAIL | âŒ Server failure | Le serveur DNS a Ã©chouÃ©
| REFUSED | âŒ RefusÃ© | RequÃªte rejetÃ©e (filtrage, ACL...)
| FORMERR | âŒ Format error | RequÃªte mal formÃ©e
| NOTIMP | âŒ Not implemented | Le serveur ne connaÃ®t pas lâ€™opÃ©ration
|===

=== ðŸ§© `flags: qr rd ra ad ...`

Indiquent les propriÃ©tÃ©s de la requÃªte/rÃ©ponse

|===
| Flag | Signification

| `qr` | Query Response (rÃ©ponse, toujours prÃ©sent)
| `rd` | Recursion Desired (le client demande une rÃ©cursion)
| `ra` | Recursion Available (le serveur peut faire de la rÃ©cursion)
| `aa` | Authoritative Answer (le serveur rÃ©pond avec autoritÃ©)
| `tc` | Truncated (la rÃ©ponse est trop longue pour UDP)
| `ad` | Authenticated Data (validation DNSSEC)
| `cd` | Checking Disabled (validation DNSSEC dÃ©sactivÃ©e)
|===

==== ðŸ§® `QUERY`, `ANSWER`, `AUTHORITY`, `ADDITIONAL`

- Ce sont les **compteurs de sections** de la rÃ©ponse :

  | Champ | Signification
  |-------|----------------
  | `QUERY` | Nombre de questions posÃ©es (souvent 1)
  | `ANSWER` | Nombre de rÃ©ponses obtenues (ex: A, MX, etc.)
  | `AUTHORITY` | Nombre dâ€™enregistrements NS de rÃ©fÃ©rence
  | `ADDITIONAL` | Enregistrements supplÃ©mentaires (ex: glue records, OPT)

----
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
             â†‘         â†‘          â†‘              â†‘
             â”‚         â”‚          â”‚              â””â”€ Nombre de sections supplÃ©mentaires
             â”‚         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Nombre de serveurs d'autoritÃ©
             â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Nombre de rÃ©ponses obtenues
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Nombre de questions posÃ©es
----

== ðŸ” DNSSEC avec dig

=== âš™ï¸
[source, bash]
----
# Activer DNSSEC pour un domaine
dig example.com +dnssec

# ðŸ” VÃ©rifier les enregistrements de clÃ©
dig example.com DNSKEY +dnssec +multiline

# ðŸ”— Suivre la chaÃ®ne de confiance
dig example.com +dnssec +trace
----

=== ðŸ“Œ Remarque

Le flag `ad` (Authenticated Data) n'apparaÃ®t que si le serveur DNS effectue la validation DNSSEC et que la signature est valide de bout en bout. (Du trust anchor au KSK de la zone)

=== ðŸ”¹ Outils en ligne

- https://www.whatsmydns.net
- https://dnschecker.org

[.small]
Â© 2025 *rridane* â€“ [GitHub](https://github.com/rridane)
