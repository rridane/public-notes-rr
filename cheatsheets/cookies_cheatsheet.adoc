= Deep Dive ‚Äì Cookies HTTP
:author-url: https://github.com/rridane
:author: rridane
:source-highlighter: rouge
:hardbreaks:
:toc: left
:toclevels: 3
:numbered:

== üç™ D√©finition

Un cookie HTTP : *paire cl√©/valeur* stock√©e par le navigateur pour un domaine donn√©. Automatiquement renvoy√© dans les futures requ√™tes HTTP, selon les contraintes de s√©curit√© d√©finies (`Path`, `Domain`, `Secure`, `SameSite`, etc.).

[plantuml]
----
@startuml
actor "Navigateur" as Browser
participant "Serveur" as Server

== Initialisation ==
Server -> Browser : Set-Cookie: session_id=abc123; Path=/; HttpOnly

== Requ√™tes suivantes ==
Browser -> Server : Cookie: session_id=abc123

note right of Server
Si :
- Domaine + Path correspondent
- Connexion HTTPS (si Secure)
- Contrainte SameSite OK
end note
@enduml
----

[source,http]
----
Set-Cookie: nom=valeur; Expires=...; Path=/; Domain=...; Secure; HttpOnly; SameSite=Strict
----

[cols="1,3",options="header"]
|===
|Attribut |Description

|`nom=valeur` | Paires cl√©/valeur (UTF-8, 4096 bytes max)
|`Expires` ou `Max-Age` | Date d‚Äôexpiration (RFC 1123) ou TTL en secondes
|`Path` | Port√©e du cookie (ex: `/`, `/admin`)
|`Domain` | Domaine concern√© (ex: `.example.com`)
|`Secure` | Envoy√© uniquement via HTTPS
|`HttpOnly` | Inaccessible par JavaScript (anti-XSS)
|`SameSite` | Politique intersite (`Lax`, `Strict`, `None`)
|===

[source,http]
----
GET /dashboard HTTP/1.1
Host: example.com
Cookie: session_id=abc123; theme=dark
----

Le navigateur **renvoie automatiquement** les cookies valides en fonction du domaine, du path, et des r√®gles de s√©curit√©.

[source,bash]
----
# 1. Appel avec cookie fix√© par serveur
curl -c cookies.txt https://example.com/login

# 2. Appel avec cookie renvoy√©
curl -b cookies.txt https://example.com/dashboard
----

* `-c cookies.txt` = √©crit les cookies re√ßus
* `-b cookies.txt` = renvoie les cookies enregistr√©s

`Set-Cookie`, exemple dans diff√©rents langages :

[cols="1,2",options="header"]
|===
|Langage | Code

|PHP
|`setcookie("name", "value", [...]);`

|Node.js
|`res.setHeader('Set-Cookie', 'name=value; Path=/; HttpOnly');`

|Python (Flask)
|`response.set_cookie("name", "value", httponly=True)`

|Go
|`http.SetCookie(w, &http.Cookie{Name: "name", Value: "value"})`

|Java
|`response.addCookie(new Cookie("name", "value"));`
|===

== üîê Attributs de s√©curit√©

=== Secure

- Transmet le cookie uniquement via HTTPS
- Emp√™che les attaques MITM en clair

=== HttpOnly

- Emp√™che l‚Äôacc√®s via `document.cookie`
- Prot√®ge contre les attaques XSS

=== SameSite

[cols="1,3",options="header"]
|===
|Valeur | Comportement

|`Strict` | Jamais envoy√© dans les requ√™tes intersites (meilleure s√©curit√© CSRF)
|`Lax` | Envoy√© pour les requ√™tes GET (navigation normale)
|`None` | Envoy√© dans tous les cas (n√©cessite `Secure`)
|===

[source,http]
----
Set-Cookie: session_id=abc123;
  Max-Age=3600;
  Path=/;
  Domain=example.com;
  Secure;
  HttpOnly;
  SameSite=Strict
----