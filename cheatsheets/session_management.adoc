:author-url: https://github.com/rridane
:author: rridane
:source-highlighter: rouge
:hardbreaks:
:table-caption!:
:toc: left
:toclevels: 3
:numbered:

= Session Management â€“ Fiche complÃ¨te

[plantuml]
----
@startuml
actor "Utilisateur" as User
participant "Navigateur"
participant "Serveur" as Server
participant "SessionStore" as Store

User -> Navigateur : Saisie identifiants
Navigateur -> Server : POST /login (credentials)
Server -> Store : CrÃ©e une session (id, user_id...)
Server -> Navigateur : Set-Cookie: session_id=abc123

Navigateur -> Server : GET /dashboard (avec cookie)
Server -> Store : RÃ©cupÃ¨re session_id
Server -> Navigateur : Contenu personnalisÃ©
@enduml
----

== âš™ï¸ Cookie de session

[source,http]
----
Set-Cookie: session_id=abc123; HttpOnly; Secure; SameSite=Strict
----

[cols="1,3",options="header"]
|===
|Attribut |Explication

|HttpOnly  |Interdit lâ€™accÃ¨s JS au cookie (anti-XSS)
|Secure    |Transmis uniquement via HTTPS
|SameSite  |EmpÃªche les requÃªtes intersites (anti-CSRF)
|Max-Age   |DurÃ©e de vie explicite (en secondes)
|Path      |URL concernÃ©e par le cookie
|===

== ğŸ§¾ Contenu type dâ€™une session (cÃ´tÃ© serveur)

[source,json]
----
{
  "session_id": "abc123",
  "user_id": 42,
  "roles": ["admin"],
  "created_at": "2025-07-30T08:00:00Z",
  "expires_at": "2025-07-30T10:00:00Z",
  "csrf_token": "xyz456"
}
----

== ğŸ” SÃ©curitÃ© des sessions

[cols="2,3",options="header"]
|===
|ProblÃ¨me |Contremesure

|Session Fixation  |RegÃ©nÃ©rer le session_id aprÃ¨s login
|Session Hijacking |HttpOnly, Secure, rotation, scope IP
|CSRF              |SameSite + CSRF token
|===

== ğŸ” Expiration & Logout

- *Idle Timeout* : expiration aprÃ¨s inactivitÃ©
- *Expiration absolue* : durÃ©e maximale stricte (ex: 2h)
- *Logout* :
- Supprimer la session cÃ´tÃ© serveur
- Invalider le cookie cÃ´tÃ© client

[source,http]
----
Set-Cookie: session_id=; Max-Age=0; Path=/; HttpOnly
----

=== ğŸ§ª Tests avec `curl`

[source,bash]
----
# Authentification (crÃ©ation session manuelle)
curl -c cookies.txt -X POST -d "username=bob&password=secret123" http://localhost/login.php

# RequÃªte GET authentifiÃ©e
curl -b cookies.txt http://localhost/dashboard.php

# DÃ©connexion
curl -b cookies.txt http://localhost/logout.php
----

== âš–ï¸ Comparaison JWT vs Session

[cols="1,2,2",options="header"]
|===
|CritÃ¨re |Session |JWT

|Stateless |âŒ Non |âœ… Oui
|Stockage serveur |âœ… Oui |âŒ Non
|Lisible cÃ´tÃ© client |âŒ Non |âœ… Oui (claims)
|RÃ©vocable facilement |âœ… Oui |âŒ Difficile
|Risques |Hijacking |Vol de token
|===
