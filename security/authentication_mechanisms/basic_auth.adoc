// :author: ChatGPT
:source-highlighter: rouge
:hardbreaks:
:toc: left
:toclevels: 3
:numbered:

= Authentification HTTP Basic ‚Äì Fiche compl√®te

== D√©finition

HTTP Basic Auth est un m√©canisme d‚Äôauthentification d√©fini dans la RFC 7617. Il consiste √† transmettre un identifiant et un mot de passe dans chaque requ√™te HTTP via un en-t√™te `Authorization` encod√© en Base64.

== Format de l‚Äôen-t√™te

[source,http]
----
Authorization: Basic base64(username:password)
----

.Exemple
----
Authorization: Basic dXNlcjpwYXNzd29yZA==
# "dXNlcjpwYXNzd29yZA==" = base64("user:password")
----

== Fonctionnement

. Le client acc√®de √† une ressource prot√©g√©e.
. Le serveur r√©pond :
[source,http]
----
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Basic realm="example"
----
. Le client renvoie la requ√™te avec l‚Äôen-t√™te `Authorization`.

== Caract√©ristiques

[cols="1,3",options="header"]
|===
|Propri√©t√© |D√©tail

|Stateless
|Chaque requ√™te est ind√©pendante, pas de session serveur

|Encodage Base64
|Ne prot√®ge pas les donn√©es (ce n‚Äôest pas un chiffrement)

|N√©cessite HTTPS
|Sinon, les credentials peuvent √™tre intercept√©s

|Pas de gestion de session
|Pas de cookie, pas de token, pas d‚Äôexpiration native

|Interop√©rable
|Support√© par tous les serveurs et navigateurs
|===

== Risques de s√©curit√©

[cols="1,3",options="header"]
|===
|Risque |D√©tail

|Transmission en clair
|Si non chiffr√© par HTTPS

|Pas de r√©vocation
|Impossible d‚Äôinvalider un identifiant sans changer le mot de passe

|Pas d‚Äôexpiration
|Le mot de passe est valide ind√©finiment

|Pas de granularit√©
|Aucun scope, ni client, ni permissions int√©gr√©es

|Pas de logout possible
|Le navigateur garde les credentials jusqu‚Äô√† fermeture
|===

== Limitations pratiques

* Pas de support natif de logout c√¥t√© navigateur
* Pas de support de permissions dans le protocole
* Pas de suivi ou journalisation des sessions
* Utilisable en CORS seulement si bien configur√© (`credentials: include`, headers CORS expos√©s, voir section associ√©e)
* Ne supporte pas les permissions ou autorisations avanc√©es

== Basic Auth et CORS ‚Äì Fonctionnement d√©taill√©

Lorsque Basic Auth est utilis√©e dans un appel `fetch()` ou `XMLHttpRequest` vers un domaine diff√©rent (CORS), le navigateur impose une v√©rification de s√©curit√© suppl√©mentaire : le pr√©flight.

=== üìå 1. Requ√™te pr√©flight `OPTIONS` (automatique)

Avant d‚Äôenvoyer la requ√™te r√©elle, le navigateur envoie une requ√™te `OPTIONS` pour v√©rifier si le serveur autorise :

- L‚Äôorigine du client
- L‚Äôen-t√™te `Authorization`
- L‚Äôusage de credentials

[source,http]
----
OPTIONS /api/data HTTP/1.1
Host: api.example.com
Origin: https://frontend.example.com
Access-Control-Request-Method: GET
Access-Control-Request-Headers: Authorization
----

=== üì§ 2. R√©ponse du serveur attendue

[source,http]
----
HTTP/1.1 204 No Content
Access-Control-Allow-Origin: https://frontend.example.com
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Authorization
Access-Control-Allow-Credentials: true
----

[NOTE]
====
* `Access-Control-Allow-Origin` doit √™tre l‚Äôorigine pr√©cise, jamais `*` si `Allow-Credentials: true`.
* `Authorization` est un header non simple : il doit √™tre list√© dans `Access-Control-Allow-Headers`.
* `Access-Control-Allow-Credentials` est requis pour que le navigateur envoie les credentials (cela comprends cookies, en-t√™te Authorization, client certs)
====

=== ‚úÖ 3. Requ√™te `GET` r√©elle envoy√©e

[source,http]
----
GET /api/data HTTP/1.1
Host: api.example.com
Origin: https://frontend.example.com
Authorization: Basic dXNlcjpwYXNz
----

Cette requ√™te n‚Äôest √©mise **que si** la r√©ponse `OPTIONS` est conforme.

=== üì§ 4. R√©ponse finale du serveur

[source,http]
----
HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://frontend.example.com
Access-Control-Allow-Credentials: true
Content-Type: application/json

{ "message": "Acc√®s autoris√©" }
----

=== üö´ Cas d‚Äôerreur fr√©quents

[cols="1,3",options="header"]
|===
|Erreur navigateur |Cause

|Access-Control-Allow-Origin: * avec credentials
|Interdit par la sp√©cification CORS

|Authorization header bloqu√©
|Oubli de `Access-Control-Allow-Headers: Authorization`

|Credentials non envoy√©s
|Oubli de `credentials: include` c√¥t√© client ou `Allow-Credentials` c√¥t√© serveur

|CORS preflight √©choue
|R√©ponse `OPTIONS` incompl√®te ou absente
|===

=== üß† En r√©sum√©

Pour que Basic Auth fonctionne avec CORS :

- C√¥t√© client :
- `Authorization` dans la requ√™te
- `credentials: "include"`
- C√¥t√© serveur :
- `Access-Control-Allow-Origin` sp√©cifique (pas `*`)
- `Access-Control-Allow-Headers: Authorization`
- `Access-Control-Allow-Credentials: true`

== Encodage et internationalisation

Par d√©faut, les identifiants Basic Auth sont encod√©s en `ISO-8859-1` (latin1), ce qui peut poser des probl√®mes avec les caract√®res non-ASCII.

Depuis la RFC 7617, un serveur peut indiquer qu‚Äôil attend du `UTF-8` via :

[source,http]
----
WWW-Authenticate: Basic realm="example", charset="UTF-8"
----

‚ö†Ô∏è Tous les clients ne supportent pas cette extension (en particulier les anciens navigateurs ou certains scripts).

== Basic Auth pour les proxies

Basic Auth est aussi utilis√© pour authentifier les clients aupr√®s d‚Äôun proxy HTTP.

Requ√™te :

[source,http]
----
Proxy-Authorization: Basic base64(user:pass)
----

R√©ponse :

[source,http]
----
407 Proxy Authentication Required
Proxy-Authenticate: Basic realm="Proxy"
----

== Utilisation dans les serveurs Web

=== Apache (fichier .htaccess)

[source,apache]
----
AuthType Basic
AuthName "Espace priv√©"
AuthUserFile /etc/apache2/.htpasswd
Require valid-user
----

=== Nginx

[source,nginx]
----
location / {
  auth_basic "Restricted Area";
  auth_basic_user_file /etc/nginx/.htpasswd;
}
----

=== Cr√©ation d‚Äôun fichier .htpasswd

[source,bash]
----
htpasswd -c /etc/nginx/.htpasswd user1
# Puis entrer le mot de passe
----

== Bonnes pratiques

* Toujours chiffrer via HTTPS
* Ne pas l‚Äôutiliser pour des APIs publiques sans contr√¥le suppl√©mentaire
* Limiter √† des cas simples : scripts, tests, environnements internes
* Ajouter `Cache-Control: no-store` pour √©viter le cache de credentials
* Si possible, utiliser bcrypt comme hash de mot de passe dans `.htpasswd`

== Alternatives recommand√©es

[cols="1,3",options="header"]
|===
|Alternative |Avantages

|JWT (JSON Web Token)
|Token sign√©, autoport√©, expiration, scopes, roles

|OAuth2
|D√©l√©gation, gestion fine des permissions, clients multiples

|API Key
|Simplicit√©, meilleure s√©paration des clients, mais toujours √† s√©curiser via HTTPS

|Mutual TLS
|Tr√®s haut niveau de s√©curit√©, mais complexe √† d√©ployer

|Session cookie + CSRF
|Approche classique pour applications Web
|===

== Exemples de requ√™tes

=== cURL

[source,bash]
----
curl -u user:password https://api.example.com/data
----

=== JavaScript (Fetch API)

[source,javascript]
----
fetch("https://api.example.com/data", {
  method: "GET",
  headers: {
    "Authorization": "Basic " + btoa("user:password")
  },
  credentials: "include"
});
----

== En r√©sum√©

[cols="1,3",options="header"]
|===
|Aspect |R√©sum√©

|Simplicit√©
|Extr√™me, universellement support√©

|S√©curit√©
|Tr√®s faible sans HTTPS, aucun m√©canisme de r√©vocation

|Interop√©rabilit√©
|Totale (clients HTTP, navigateurs, serveurs web)

|Cas d‚Äôusage pertinents
|Script, API interne, Docker registry priv√©, tests rapides

|Cas √† √©viter
|Applications Web publiques, API sensibles, absence de HTTPS
|===

